# YouTube API 할당량 분석 및 최적화 방안

## 📊 동영상 API 호출 할당량 분석

### 현재 동영상 가져오기 시 API 호출

동영상을 가져올 때 다음 3개의 API 호출이 발생합니다:

1. **channels.list** (contentDetails) = **1 unit**
   - 채널의 uploads playlist ID 가져오기

2. **playlistItems.list** = **1 unit**
   - 플레이리스트에서 최근 동영상 ID 목록 가져오기

3. **videos.list** (snippet, statistics) = **1 unit**
   - 동영상 상세 정보 가져오기

**총: 3 units per 채널**

### 할당량 소모 시나리오

| 방문자 수 | 동영상 API 호출 | 할당량 소모 | 일일 할당량 대비 |
|---------|--------------|-----------|----------------|
| 100명 | 300 units | 3% | ✅ 안전 |
| 500명 | 1,500 units | 15% | ✅ 안전 |
| 1,000명 | 3,000 units | 30% | ⚠️ 주의 |
| 3,000명 | 9,000 units | 90% | ❌ 위험 |

### 현재 문제점

1. **프로필 페이지 열 때마다 동영상 API 호출**
   - 사용자가 프로필 페이지를 방문할 때마다 3 units 소모
   - 캐시가 10분이지만, 사용자가 많으면 할당량 빠르게 소진

2. **동영상은 자주 업데이트되지 않음**
   - 동영상은 하루에 몇 개씩만 업로드됨
   - 매번 API 호출하는 것은 비효율적

3. **데이터베이스 저장 없음**
   - 현재는 동영상을 DB에 저장하지 않고 매번 API 호출
   - 할당량 낭비

## 💡 최적화 방안

### 방안 1: 캐시 시간 증가 (즉시 적용 가능)

**현재**: 10분 캐시
**제안**: 1시간 또는 6시간 캐시

```typescript
const CACHE_TTL = 60 * 60 * 1000; // 1시간
// 또는
const CACHE_TTL = 6 * 60 * 60 * 1000; // 6시간
```

**효과**:
- 할당량 소모 90% 감소 (10분 → 1시간)
- 사용자 경험 영향 최소 (동영상은 자주 업데이트 안 됨)

### 방안 2: 데이터베이스 저장 + 주기적 업데이트 (권장)

**현재**: 매번 API 호출
**제안**: DB에 저장하고 주기적으로 업데이트

```typescript
// 동영상을 DB에 저장하고, 6시간마다 업데이트
// 프로필 페이지에서는 DB에서 가져오기
```

**효과**:
- 할당량 소모 거의 0% (주기적 업데이트만)
- 사용자 경험 향상 (빠른 로딩)

### 방안 3: 선택적 동영상 표시

**현재**: 모든 프로필 페이지에서 동영상 표시
**제안**: 사용자가 "최근 동영상 보기" 버튼 클릭 시에만 로드

**효과**:
- 할당량 소모 80-90% 감소
- 필요한 경우에만 API 호출

### 방안 4: 하이브리드 접근 (최적)

**구현**:
1. 동영상을 DB에 저장
2. 프로필 페이지에서는 DB에서 가져오기
3. 백그라운드에서 주기적으로 업데이트 (6시간마다)
4. 사용자가 "새로고침" 버튼 클릭 시에만 최신 데이터 가져오기

**효과**:
- 할당량 소모 최소화
- 사용자 경험 최적화
- 최신 데이터 필요 시 제공

## 📋 권장 사항

### 즉시 적용 가능 (방안 1)
- 캐시 시간을 1시간으로 증가
- 할당량 소모 즉시 감소

### 중기 개선 (방안 2 + 방안 4)
- 동영상을 DB에 저장
- 주기적 업데이트 (6시간마다)
- 사용자 요청 시 최신 데이터 제공

### 장기 개선 (방안 3)
- 선택적 동영상 표시
- 사용자 경험 개선

## 🎯 예상 효과

| 방안 | 할당량 절감 | 구현 난이도 | 사용자 경험 |
|-----|-----------|-----------|-----------|
| 방안 1 (캐시 증가) | 90% | ⭐ 쉬움 | ✅ 좋음 |
| 방안 2 (DB 저장) | 95% | ⭐⭐ 보통 | ✅✅ 매우 좋음 |
| 방안 3 (선택적 표시) | 80-90% | ⭐⭐ 보통 | ⚠️ 보통 |
| 방안 4 (하이브리드) | 95%+ | ⭐⭐⭐ 어려움 | ✅✅✅ 최고 |

## 💰 비용 분석

### 현재 (캐시 10분)
- 프로필 페이지 1,000명 방문 = 3,000 units
- 일일 할당량의 30% 소모

### 방안 1 적용 후 (캐시 1시간)
- 프로필 페이지 1,000명 방문 = 300 units (같은 채널 재방문 시)
- 일일 할당량의 3% 소모
- **할당량 절감: 90%**

### 방안 2 + 방안 4 적용 후
- 프로필 페이지 1,000명 방문 = 0 units (DB에서 가져오기)
- 주기적 업데이트만 = 약 100-200 units/일
- **할당량 절감: 95%+**

