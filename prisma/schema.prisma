// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Category {
  id          String   @id @default(cuid())
  name        String   @unique
  nameEn      String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  channels YouTubeChannel[]

  @@map("categories")
}

model YouTubeChannel {
  id               String    @id @default(cuid())
  channelId        String    @unique // YouTube Channel ID
  channelName      String
  handle           String? // @handle
  profileImageUrl  String?
  categoryId       String
  category         Category  @relation(fields: [categoryId], references: [id])
  subscriberCount  BigInt    @default(0)
  totalViewCount   BigInt    @default(0)
  videoCount       Int       @default(0)
  description      String?   @db.Text
  country          String?
  createdAt        DateTime  @default(now())
  channelCreatedAt DateTime?

  // 주간 데이터
  weeklySubscriberChange     BigInt @default(0)
  weeklySubscriberChangeRate Float  @default(0)
  weeklyViewCount            BigInt @default(0)
  weeklyViewCountChange      BigInt @default(0)
  weeklyViewCountChangeRate  Float  @default(0)

  // 참여 지표
  averageEngagementRate Float @default(0)

  // 순위
  currentRank  Int?
  previousRank Int?
  rankChange   Int  @default(0)

  // 업데이트
  lastUpdated DateTime @default(now())

  // Relations
  videos       Video[]
  growthData   GrowthData[]
  adPlacements AdPlacement[]

  @@index([categoryId])
  @@index([currentRank])
  @@index([subscriberCount])
  @@index([lastUpdated])
  @@map("youtube_channels")
}

model Video {
  id             String         @id @default(cuid())
  videoId        String         @unique // YouTube Video ID
  channelId      String
  channel        YouTubeChannel @relation(fields: [channelId], references: [id])
  title          String
  thumbnailUrl   String?
  publishedAt    DateTime
  viewCount      BigInt         @default(0)
  likeCount      Int            @default(0)
  commentCount   Int            @default(0)
  engagementRate Float          @default(0)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  @@index([channelId])
  @@index([publishedAt])
  @@map("videos")
}

model GrowthData {
  id              String         @id @default(cuid())
  channelId       String
  channel         YouTubeChannel @relation(fields: [channelId], references: [id])
  date            DateTime
  subscriberCount BigInt
  viewCount       BigInt
  createdAt       DateTime       @default(now())

  @@index([channelId, date])
  @@map("growth_data")
}

model Ad {
  id                String   @id @default(cuid())
  name              String
  type              String // banner, native, pixel, infeed, sticky
  position          Json // AdPosition
  content           String   @db.Text // HTML/이미지 URL/픽셀 코드
  displayConditions Json // AdDisplayConditions
  schedule          Json // { startDate, endDate }
  frequency         Json // { maxPerDay, maxPerSession }
  status            String   @default("paused") // active, paused, archived
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  placements   AdPlacement[]
  performances AdPerformance[]

  @@index([status])
  @@index([type])
  @@map("ads")
}

model AdPlacement {
  id        String          @id @default(cuid())
  adId      String
  ad        Ad              @relation(fields: [adId], references: [id])
  channelId String?
  channel   YouTubeChannel? @relation(fields: [channelId], references: [id])
  page      String // home, ranking, channel, category, search, all
  location  String // header, sidebar, content-top, content-middle, content-bottom, footer, sticky
  priority  Int             @default(0)
  createdAt DateTime        @default(now())

  @@index([adId])
  @@index([page, location])
  @@map("ad_placements")
}

model AdPerformance {
  id          String   @id @default(cuid())
  adId        String
  ad          Ad       @relation(fields: [adId], references: [id])
  date        DateTime
  impressions BigInt   @default(0)
  clicks      BigInt   @default(0)
  revenue     Decimal  @default(0) @db.Decimal(10, 2)
  ctr         Float    @default(0)
  ecpm        Decimal  @default(0) @db.Decimal(10, 2)
  createdAt   DateTime @default(now())

  @@index([adId, date])
  @@map("ad_performances")
}

model Pixel {
  id        String   @id @default(cuid())
  name      String
  type      String // facebook, google, google-tag-manager, custom
  code      String   @db.Text
  events    Json // PixelEvent[]
  status    String   @default("paused") // active, paused
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status])
  @@map("pixels")
}

model SEOConfig {
  id            String   @id @default(cuid())
  page          String   @unique // 페이지 경로
  title         String
  description   String   @db.Text
  keywords      String[] @default([])
  ogImage       String?
  ogTitle       String?
  ogDescription String?  @db.Text
  twitterCard   String?
  canonicalUrl  String?
  schema        Json?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("seo_configs")
}

model SEOKeyword {
  id           String   @id @default(cuid())
  keyword      String
  currentRank  Int?
  previousRank Int?
  searchVolume Int      @default(0)
  difficulty   Int      @default(0)
  trackedAt    DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([keyword])
  @@map("seo_keywords")
}

model CollaborationInquiry {
  id          String    @id @default(cuid())
  name        String
  email       String
  company     String?
  phone       String?
  subject     String
  message     String    @db.Text
  type        String // partnership, advertising, content, other
  status      String    @default("pending") // pending, in-progress, completed, archived
  response    String?   @db.Text
  respondedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([status])
  @@index([type])
  @@index([createdAt])
  @@map("collaboration_inquiries")
}
